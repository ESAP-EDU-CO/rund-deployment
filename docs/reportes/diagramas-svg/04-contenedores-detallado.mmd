flowchart TB
    subgraph Internet["ğŸŒ Acceso de Red"]
        Usuario["ğŸ‘¤ Usuario ESAP"]
    end

    subgraph Server["ğŸ–¥ï¸ Servidor Docker - 172.16.234.52"]
        subgraph Funcionales["âœ… Componentes Funcionales"]
            MGP["ğŸ–¥ï¸ RUND-MGP<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Angular 20 + SSR<br/>Node.js 20.x<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Puerto: 4000"]

            AUTH["ğŸ”‘ RUND-AUTH<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Node.js + Express<br/>JWT + MSAL<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Puerto: 4100"]

            API["âš™ï¸ RUND-API<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>PHP 8.3 + Apache<br/>LibreOffice<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Puerto: 3000"]

            CORE["ğŸ“ RUND-CORE<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>OpenKM CE<br/>Java + Tomcat<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Puerto: 8080"]
        end

        subgraph Experimentales["ğŸ§ª Componentes Experimentales"]
            AI["ğŸ¤– RUND-AI<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Python + Flask<br/>ChromaDB<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Puerto: 8001"]

            OCR["ğŸ“„ RUND-OCR<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Python + PaddleOCR<br/>ES/EN<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Puerto: 8000"]

            OLLAMA["ğŸ§  RUND-OLLAMA<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>Ollama Engine<br/>nuextract, gemma2<br/>â”â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“ Puerto: 11434"]
        end

        subgraph Storage["ğŸ’¾ Almacenamiento Persistente"]
            V1[("openkm-data<br/>10-50 GB")]
            V2[("ollama-data<br/>6 GB")]
            V3[("ai-cache<br/>1-2 GB")]
        end
    end

    subgraph External["â˜ï¸ Servicios Externos"]
        ENTRA["ğŸ”· Microsoft Entra ID"]
    end

    Usuario -->|"HTTP :4000"| MGP
    MGP -->|"HTTP :3000"| API
    MGP -->|"HTTP :4100"| AUTH
    AUTH <-->|"OAuth 2.0 / OIDC"| ENTRA
    API -->|"HTTP :8080<br/>Basic Auth"| CORE
    API -->|"HTTP :8001"| AI
    API -->|"HTTP :8000"| OCR
    AI -->|"HTTP :11434"| OLLAMA
    AI -->|"HTTP :8000"| OCR
    AI -->|"HTTP :3000"| API

    CORE --- V1
    OLLAMA --- V2
    AI --- V3

    classDef funcional fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    classDef experimental fill:#fff9c4,stroke:#f9a825,stroke-width:2px,stroke-dasharray: 5 5
    classDef storage fill:#e3f2fd,stroke:#1565c0
    classDef externo fill:#fce4ec,stroke:#c2185b

    class MGP,AUTH,API,CORE funcional
    class AI,OCR,OLLAMA experimental
    class V1,V2,V3 storage
    class ENTRA externo
